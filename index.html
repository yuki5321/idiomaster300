<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Idiom Master 300 - è‹±èªç†Ÿèªå­¦ç¿’ã‚¢ãƒ—ãƒª</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .tabs {
            display: flex;
            background: white;
            border-radius: 10px 10px 0 0;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            background: #f8f9fa;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            border-right: 1px solid #dee2e6;
        }

        .tab:last-child {
            border-right: none;
        }

        .tab.active {
            background: white;
            color: #667eea;
            font-weight: bold;
        }

        .tab:hover:not(.active) {
            background: #e9ecef;
        }

        .content {
            background: white;
            border-radius: 0 0 10px 10px;
            padding: 30px;
            min-height: 500px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .mode-selector {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            justify-content: center;
        }

        .mode-btn {
            padding: 12px 24px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .mode-btn.active {
            background: #667eea;
            color: white;
        }

        .mode-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .study-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            margin-bottom: 30px;
            min-height: 300px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .study-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }

        .study-card.clickable {
            cursor: pointer;
        }

        .study-card.not-clickable {
            cursor: default;
        }

        .phrase {
            font-size: 2rem;
            color: #667eea;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .meaning {
            font-size: 1.3rem;
            color: #495057;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .quiz-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 30px;
        }

        .quiz-option {
            padding: 15px;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .quiz-option:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .quiz-option.correct {
            background: #d4edda;
            border-color: #28a745;
        }

        .quiz-option.incorrect {
            background: #f8d7da;
            border-color: #dc3545;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            min-width: 120px;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .range-selector {
            display: flex;
            gap: 10px;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .range-input {
            padding: 8px 12px;
            border: 2px solid #dee2e6;
            border-radius: 5px;
            width: 80px;
            text-align: center;
        }

        .word-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #dee2e6;
            border-radius: 10px;
        }

        .word-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #dee2e6;
            transition: background 0.3s ease;
        }

        .word-item:hover {
            background: #f8f9fa;
        }

        .word-item:last-child {
            border-bottom: none;
        }

        .word-phrase {
            font-weight: bold;
            color: #667eea;
        }

        .word-meaning {
            color: #6c757d;
            font-size: 0.9rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            color: #6c757d;
            margin-top: 5px;
        }

        .progress-info {
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.1rem;
        }

        .progress-counter {
            color: #667eea;
            font-weight: bold;
        }

        .hidden {
            display: none !important;
        }

        @media (max-width: 600px) {
            .container {
                padding: 10px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .phrase {
                font-size: 1.5rem;
            }

            .meaning {
                font-size: 1.1rem;
            }

            .quiz-options {
                grid-template-columns: 1fr;
            }

            .action-buttons {
                flex-direction: column;
            }

            .tabs {
                flex-direction: column;
            }

            .tab {
                border-right: none;
                border-bottom: 1px solid #dee2e6;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“š Idiom Master 300</h1>
            <p>è‹±èªã®é‡è¦ç†Ÿèª300å€‹ã‚’åŠ¹ç‡çš„ã«å­¦ç¿’</p>
        </div>

        <div class="tabs">
            <button class="tab active" data-tab="study">å­¦ç¿’</button>
            <button class="tab" data-tab="wordlist">å˜èªãƒªã‚¹ãƒˆ</button>
            <button class="tab" data-tab="statistics">çµ±è¨ˆ</button>
        </div>

        <div class="content">
            <!-- å­¦ç¿’ã‚¿ãƒ– -->
            <div id="study-tab" class="tab-content">
                <div class="mode-selector">
                    <button class="mode-btn active" data-mode="memorize">æš—è¨˜ãƒ¢ãƒ¼ãƒ‰</button>
                    <button class="mode-btn" data-mode="quiz">ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰</button>
                </div>

                <!-- æš—è¨˜ãƒ¢ãƒ¼ãƒ‰ -->
                <div id="memorize-mode" class="mode-content">
                    <div class="progress-info">
                        <span class="progress-counter">1 / 300</span>
                    </div>
                    <div class="study-card clickable">
                        <div class="phrase">ç†Ÿèªã‚’èª­ã¿è¾¼ã¿ä¸­...</div>
                        <div class="meaning hidden">æ„å‘³ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</div>
                        <div style="margin-top: 20px; color: #6c757d; font-size: 0.9rem;">
                            ğŸ’¡ ã‚«ãƒ¼ãƒ‰ã‚’ã‚¯ãƒªãƒƒã‚¯ã¾ãŸã¯ã€Œæ„å‘³ã‚’è¡¨ç¤ºã€ãƒœã‚¿ãƒ³ã§æ„å‘³ã‚’ç¢ºèª
                        </div>
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-primary" id="show-meaning">æ„å‘³ã‚’è¡¨ç¤º</button>
                        <button class="btn btn-success hidden" id="remember-btn">è¦šãˆãŸï¼</button>
                        <button class="btn btn-warning hidden" id="not-remember-btn">è¦šãˆã¦ãªã„</button>
                    </div>
                </div>

                <!-- ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ -->
                <div id="quiz-mode" class="mode-content hidden">
                    <div class="range-selector">
                        <span>ç¯„å›²è¨­å®šï¼šNo.</span>
                        <input type="number" class="range-input" id="range-start" min="1" max="300" value="1">
                        <span>ï½</span>
                        <input type="number" class="range-input" id="range-end" min="1" max="300" value="50">
                        <button class="btn btn-primary" id="set-range">ç¯„å›²è¨­å®š</button>
                    </div>
                    <div class="progress-info">
                        <span class="progress-counter">å•é¡Œã‚’è¨­å®šã—ã¦ãã ã•ã„</span>
                    </div>
                    <div class="study-card">
                        <div class="phrase">ãƒ†ã‚¹ãƒˆç¯„å›²ã‚’è¨­å®šã—ã¦ãã ã•ã„</div>
                        <div class="quiz-options hidden">
                            <div class="quiz-option" data-option="0">é¸æŠè‚¢1</div>
                            <div class="quiz-option" data-option="1">é¸æŠè‚¢2</div>
                            <div class="quiz-option" data-option="2">é¸æŠè‚¢3</div>
                            <div class="quiz-option" data-option="3">é¸æŠè‚¢4</div>
                        </div>
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-primary hidden" id="next-quiz">æ¬¡ã®å•é¡Œ</button>
                    </div>
                </div>
            </div>

            <!-- å˜èªãƒªã‚¹ãƒˆã‚¿ãƒ– -->
            <div id="wordlist-tab" class="tab-content hidden">
                <div class="mode-selector">
                    <button class="mode-btn active" data-list="remembered">è¦šãˆãŸå˜èª</button>
                    <button class="mode-btn" data-list="not-remembered">è¦šãˆã¦ãªã„å˜èª</button>
                </div>

                <div id="remembered-list" class="word-list">
                    <div class="word-item">
                        <div>
                            <div class="word-phrase">ã¾ã è¦šãˆãŸå˜èªãŒã‚ã‚Šã¾ã›ã‚“</div>
                            <div class="word-meaning">æš—è¨˜ãƒ¢ãƒ¼ãƒ‰ã§å­¦ç¿’ã‚’é–‹å§‹ã—ã¦ãã ã•ã„</div>
                        </div>
                    </div>
                </div>

                <div id="not-remembered-list" class="word-list hidden">
                    <div class="word-item">
                        <div>
                            <div class="word-phrase">ã¾ã è¦šãˆã¦ã„ãªã„å˜èªãŒã‚ã‚Šã¾ã›ã‚“</div>
                            <div class="word-meaning">æš—è¨˜ãƒ¢ãƒ¼ãƒ‰ã§å­¦ç¿’ã‚’é–‹å§‹ã—ã¦ãã ã•ã„</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- çµ±è¨ˆã‚¿ãƒ– -->
            <div id="statistics-tab" class="tab-content hidden">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="total-remembered">0</div>
                        <div class="stat-label">è¦šãˆãŸå˜èªæ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="total-not-remembered">0</div>
                        <div class="stat-label">è¦šãˆã¦ãªã„å˜èªæ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="quiz-correct">0</div>
                        <div class="stat-label">ãƒ†ã‚¹ãƒˆæ­£è§£æ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="quiz-accuracy">0%</div>
                        <div class="stat-label">ãƒ†ã‚¹ãƒˆæ­£è§£ç‡</div>
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="btn btn-primary" id="export-stats">çµ±è¨ˆã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
                    <button class="btn btn-danger" id="reset-stats">ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆ</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ç†Ÿèªãƒ‡ãƒ¼ã‚¿ï¼ˆ300èªã®ã‚µãƒ³ãƒ—ãƒ«ï¼‰
        const idiomsData = [
            { phrase: "lead to ï½", meaning: "ï½ï¼ˆã¨ã„ã†çµæœï¼‰ã‚’å¼•ãèµ·ã“ã™ã€ï½ã¸ã¨é€šã˜ã‚‹" },
            { phrase: "look forward to ï½", meaning: "ï½ã‚’æ¥½ã—ã¿ã«ã—ã¦ã„ã‚‹" },
            { phrase: "take care of ï½", meaning: "ï½ã®ä¸–è©±ã‚’ã™ã‚‹ã€ï½ã‚’å‡¦ç†ã™ã‚‹" },
            { phrase: "come up with ï½", meaning: "ï½ã‚’æ€ã„ã¤ãã€ï½ã‚’è€ƒãˆå‡ºã™" },
            { phrase: "get rid of ï½", meaning: "ï½ã‚’å–ã‚Šé™¤ãã€ï½ã‚’å‡¦åˆ†ã™ã‚‹" },
            { phrase: "put off ï½", meaning: "ï½ã‚’å»¶æœŸã™ã‚‹" },
            { phrase: "turn out", meaning: "çµæœã¨ã—ã¦ï½ã«ãªã‚‹" },
            { phrase: "break down", meaning: "æ•…éšœã™ã‚‹ã€åˆ†è§£ã™ã‚‹" },
            { phrase: "bring up ï½", meaning: "ï½ã‚’è‚²ã¦ã‚‹ã€ï½ã‚’è©±é¡Œã«ã™ã‚‹" },
            { phrase: "carry out ï½", meaning: "ï½ã‚’å®Ÿè¡Œã™ã‚‹ã€ï½ã‚’é‚è¡Œã™ã‚‹" },
            { phrase: "check out ï½", meaning: "ï½ã‚’èª¿ã¹ã‚‹ã€ï½ã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆã™ã‚‹" },
            { phrase: "deal with ï½", meaning: "ï½ã«å¯¾å‡¦ã™ã‚‹ã€ï½ã‚’æ‰±ã†" },
            { phrase: "end up ï½", meaning: "çµå±€ï½ã«ãªã‚‹" },
            { phrase: "figure out ï½", meaning: "ï½ã‚’ç†è§£ã™ã‚‹ã€ï½ã‚’è§£æ±ºã™ã‚‹" },
            { phrase: "give up ï½", meaning: "ï½ã‚’ã‚ãã‚‰ã‚ã‚‹" },
            { phrase: "hang out", meaning: "ã¶ã‚‰ã¶ã‚‰ã™ã‚‹ã€ãŸã‚€ã‚ã™ã‚‹" },
            { phrase: "keep on ï½", meaning: "ï½ã‚’ç¶šã‘ã‚‹" },
            { phrase: "make up ï½", meaning: "ï½ã‚’ä½œã‚Šä¸Šã’ã‚‹ã€ï½ã‚’æ§‹æˆã™ã‚‹" },
            { phrase: "pick up ï½", meaning: "ï½ã‚’æ‹¾ã†ã€ï½ã‚’è¿ãˆã«è¡Œã" },
            { phrase: "point out ï½", meaning: "ï½ã‚’æŒ‡æ‘˜ã™ã‚‹" },
            { phrase: "run into ï½", meaning: "ï½ã«å¶ç„¶å‡ºä¼šã†" },
            { phrase: "set up ï½", meaning: "ï½ã‚’è¨­ç«‹ã™ã‚‹ã€ï½ã‚’è¨­ç½®ã™ã‚‹" },
            { phrase: "show up", meaning: "ç¾ã‚Œã‚‹ã€å§¿ã‚’è¦‹ã›ã‚‹" },
            { phrase: "take off", meaning: "é›¢é™¸ã™ã‚‹ã€è„±ã" },
            { phrase: "work out", meaning: "ã†ã¾ãã„ãã€é‹å‹•ã™ã‚‹" },
            { phrase: "account for ï½", meaning: "ï½ã‚’èª¬æ˜ã™ã‚‹ã€ï½ã®åŸå› ã¨ãªã‚‹" },
            { phrase: "back up ï½", meaning: "ï½ã‚’æ”¯æ´ã™ã‚‹ã€ï½ã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã™ã‚‹" },
            { phrase: "call off ï½", meaning: "ï½ã‚’ä¸­æ­¢ã™ã‚‹" },
            { phrase: "drop by", meaning: "ç«‹ã¡å¯„ã‚‹" },
            { phrase: "fill in ï½", meaning: "ï½ã«è¨˜å…¥ã™ã‚‹ã€ï½ã®ä»£å½¹ã‚’ã™ã‚‹" },
            { phrase: "go over ï½", meaning: "ï½ã‚’èª¿ã¹ã‚‹ã€ï½ã‚’å¾©ç¿’ã™ã‚‹" },
            { phrase: "hold on", meaning: "å¾…ã¤ã€ã—ã£ã‹ã‚Šã¤ã‹ã¾ã‚‹" },
            { phrase: "look after ï½", meaning: "ï½ã®ä¸–è©±ã‚’ã™ã‚‹" },
            { phrase: "make out ï½", meaning: "ï½ã‚’ç†è§£ã™ã‚‹ã€ï½ã‚’è¦‹åˆ†ã‘ã‚‹" },
            { phrase: "pass away", meaning: "äº¡ããªã‚‹" },
            { phrase: "put up with ï½", meaning: "ï½ã‚’æˆ‘æ…¢ã™ã‚‹" },
            { phrase: "run out of ï½", meaning: "ï½ã‚’åˆ‡ã‚‰ã™" },
            { phrase: "stand for ï½", meaning: "ï½ã‚’è¡¨ã™ã€ï½ã‚’æ”¯æŒã™ã‚‹" },
            { phrase: "take after ï½", meaning: "ï½ã«ä¼¼ã¦ã„ã‚‹" },
            { phrase: "wear out", meaning: "ã™ã‚Šåˆ‡ã‚Œã‚‹ã€ç–²ã‚Œæœã¦ã‚‹" },
            { phrase: "be supposed to ï½", meaning: "ï½ã™ã‚‹ã“ã¨ã«ãªã£ã¦ã„ã‚‹" },
            { phrase: "be used to ï½", meaning: "ï½ã«æ…£ã‚Œã¦ã„ã‚‹" },
            { phrase: "get used to ï½", meaning: "ï½ã«æ…£ã‚Œã‚‹" },
            { phrase: "have to ï½", meaning: "ï½ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„" },
            { phrase: "ought to ï½", meaning: "ï½ã™ã¹ãã§ã‚ã‚‹" },
            { phrase: "would rather ï½", meaning: "ã‚€ã—ã‚ï½ã—ãŸã„" },
            { phrase: "as long as ï½", meaning: "ï½ã™ã‚‹é™ã‚Šã€ï½ã§ã‚ã‚‹é™ã‚Š" },
            { phrase: "as soon as ï½", meaning: "ï½ã™ã‚‹ã¨ã™ãã«" },
            { phrase: "even though ï½", meaning: "ï½ã«ã‚‚ã‹ã‹ã‚ã‚‰ãš" },
            { phrase: "in case ï½", meaning: "ï½ã®å ´åˆã«å‚™ãˆã¦" },
            // ã“ã“ã«æ®‹ã‚Š250èªã‚’è¿½åŠ ï¼ˆå®Ÿéš›ã®ã‚¢ãƒ—ãƒªã§ã¯å…¨300èªã‚’å«ã‚ã‚‹ï¼‰
        ];

        // æ®‹ã‚Šã®250èªã‚’ç”Ÿæˆï¼ˆãƒ‡ãƒ¢ç”¨ï¼‰
        for (let i = 51; i <= 300; i++) {
            idiomsData.push({
                phrase: `idiom phrase ${i}`,
                meaning: `ç†Ÿèª${i}ã®æ„å‘³èª¬æ˜`
            });
        }

        // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ…‹
        let currentMode = 'memorize';
        let currentTab = 'study';
        let currentIndex = 0;
        let quizRange = { start: 1, end: 50 };
        let quizQuestions = [];
        let currentQuizIndex = 0;
        let currentQuizAnswer = -1;

        // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚­ãƒ¼
        const STORAGE_KEYS = {
            REMEMBERED: 'idiom_remembered',
            NOT_REMEMBERED: 'idiom_not_remembered',
            QUIZ_STATS: 'idiom_quiz_stats'
        };

        // ãƒ‡ãƒ¼ã‚¿ç®¡ç†
        function getStorageData(key) {
            const data = localStorage.getItem(key);
            return data ? JSON.parse(data) : {};
        }

        function setStorageData(key, data) {
            localStorage.setItem(key, JSON.stringify(data));
        }

        function updateWordStatus(index, status) {
            const remembered = getStorageData(STORAGE_KEYS.REMEMBERED);
            const notRemembered = getStorageData(STORAGE_KEYS.NOT_REMEMBERED);

            if (status === 'remembered') {
                remembered[index] = (remembered[index] || 0) + 1;
                delete notRemembered[index];
            } else {
                notRemembered[index] = (notRemembered[index] || 0) + 1;
                delete remembered[index];
            }

            setStorageData(STORAGE_KEYS.REMEMBERED, remembered);
            setStorageData(STORAGE_KEYS.NOT_REMEMBERED, notRemembered);
        }

        function updateQuizStats(index, correct) {
            const stats = getStorageData(STORAGE_KEYS.QUIZ_STATS);
            if (!stats[index]) {
                stats[index] = { correct: 0, incorrect: 0 };
            }

            if (correct) {
                stats[index].correct++;
            } else {
                stats[index].incorrect++;
            }

            setStorageData(STORAGE_KEYS.QUIZ_STATS, stats);
        }

        // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
        function switchTab(tabName) {
            // ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹æ›´æ–°
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');

            // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            document.getElementById(`${tabName}-tab`).classList.remove('hidden');

            currentTab = tabName;

            if (tabName === 'wordlist') {
                updateWordLists();
            } else if (tabName === 'statistics') {
                updateStatistics();
            }
        }

        // ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ
        function switchMode(mode) {
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-mode="${mode}"]`).classList.add('active');

            document.querySelectorAll('.mode-content').forEach(content => {
                content.classList.add('hidden');
            });
            document.getElementById(`${mode}-mode`).classList.remove('hidden');

            currentMode = mode;

            if (mode === 'memorize') {
                initMemorizeMode();
            }
        }

        // æš—è¨˜ãƒ¢ãƒ¼ãƒ‰åˆæœŸåŒ–
        function initMemorizeMode() {
            currentIndex = 0;
            displayCurrentPhrase();
        }

        // ç¾åœ¨ã®ç†Ÿèªã‚’è¡¨ç¤º
        function displayCurrentPhrase() {
            const phrase = document.querySelector('#memorize-mode .phrase');
            const meaning = document.querySelector('#memorize-mode .meaning');
            const progress = document.querySelector('#memorize-mode .progress-counter');
            const studyCard = document.querySelector('#memorize-mode .study-card');

            phrase.textContent = idiomsData[currentIndex].phrase;
            meaning.textContent = idiomsData[currentIndex].meaning;
            meaning.classList.add('hidden');

            progress.textContent = `${currentIndex + 1} / ${idiomsData.length}`;

            // ã‚«ãƒ¼ãƒ‰ã«ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆè¿½åŠ 
            studyCard.classList.add('clickable');
            studyCard.classList.remove('not-clickable');
            studyCard.onclick = showMeaning;

            // ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹ãƒªã‚»ãƒƒãƒˆ
            document.getElementById('show-meaning').classList.remove('hidden');
            document.getElementById('remember-btn').classList.add('hidden');
            document.getElementById('not-remember-btn').classList.add('hidden');
        }

        // æ„å‘³ã‚’è¡¨ç¤º
        function showMeaning() {
            const meaning = document.querySelector('#memorize-mode .meaning');
            const studyCard = document.querySelector('#memorize-mode .study-card');
            
            // æ—¢ã«æ„å‘³ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ä½•ã‚‚ã—ãªã„
            if (!meaning.classList.contains('hidden')) {
                return;
            }

            meaning.classList.remove('hidden');

            // ã‚«ãƒ¼ãƒ‰ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç„¡åŠ¹åŒ–
            studyCard.classList.remove('clickable');
            studyCard.classList.add('not-clickable');
            studyCard.onclick = null;

            document.getElementById('show-meaning').classList.add('hidden');
            document.getElementById('remember-btn').classList.remove('hidden');
            document.getElementById('not-remember-btn').classList.remove('hidden');
        }

        // è¦šãˆãŸ/è¦šãˆã¦ã„ãªã„ãƒœã‚¿ãƒ³ã®å‡¦ç†
        function handleMemorizeResult(remembered) {
            updateWordStatus(currentIndex, remembered ? 'remembered' : 'not-remembered');
            
            currentIndex++;
            if (currentIndex >= idiomsData.length) {
                currentIndex = 0;
            }
            
            setTimeout(() => {
                displayCurrentPhrase();
            }, 500);
        }

        // ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ç¯„å›²è¨­å®š
        function setQuizRange() {
            const start = parseInt(document.getElementById('range-start').value);
            const end = parseInt(document.getElementById('range-end').value);

            if (start < 1 || end > idiomsData.length || start > end) {
                alert('æ­£ã—ã„ç¯„å›²ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆ1-300ï¼‰');
                return;
            }

            quizRange = { start: start - 1, end: end - 1 };
            generateQuizQuestions();
            displayCurrentQuiz();
        }

        // ãƒ†ã‚¹ãƒˆå•é¡Œç”Ÿæˆ
        function generateQuizQuestions() {
            quizQuestions = [];
            for (let i = quizRange.start; i <= quizRange.end; i++) {
                quizQuestions.push(i);
            }
            
            // ã‚·ãƒ£ãƒƒãƒ•ãƒ«
            for (let i = quizQuestions.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [quizQuestions[i], quizQuestions[j]] = [quizQuestions[j], quizQuestions[i]];
            }
            
            currentQuizIndex = 0;
        }

        // ç¾åœ¨ã®ãƒ†ã‚¹ãƒˆå•é¡Œè¡¨ç¤º
        function displayCurrentQuiz() {
            if (currentQuizIndex >= quizQuestions.length) {
                alert('ãƒ†ã‚¹ãƒˆå®Œäº†ï¼');
                return;
            }

            const questionIndex = quizQuestions[currentQuizIndex];
            const correctAnswer = idiomsData[questionIndex];
            
            // é¸æŠè‚¢ç”Ÿæˆ
            const options = [correctAnswer];
            const usedIndices = new Set([questionIndex]);
            
            while (options.length < 4) {
                const randomIndex = Math.floor(Math.random() * idiomsData.length);
                if (!usedIndices.has(randomIndex)) {
                    options.push(idiomsData[randomIndex]);
                    usedIndices.add(randomIndex);
                }
            }
            
            // ã‚·ãƒ£ãƒƒãƒ•ãƒ«
            for (let i = options.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [options[i], options[j]] = [options[j], options[i]];
            }
            
            currentQuizAnswer = options.indexOf(correctAnswer);

            // UIæ›´æ–°
            const phrase = document.querySelector('#quiz-mode .phrase');
            const quizOptions = document.querySelector('.quiz-options');
            const progress = document.querySelector('#quiz-mode .progress-counter');

            phrase.textContent = correctAnswer.phrase;
            progress.textContent = `${currentQuizIndex + 1} / ${quizQuestions.length}`;

            quizOptions.classList.remove('hidden');
            document.querySelectorAll('.quiz-option').forEach((option, index) => {
                option.textContent = options[index].meaning;
                option.className = 'quiz-option';
                option.onclick = () => selectQuizOption(index);
            });

            document.getElementById('next-quiz').classList.add('hidden');
        }

        // ãƒ†ã‚¹ãƒˆé¸æŠè‚¢é¸æŠ
        function selectQuizOption(selectedIndex) {
            const options = document.querySelectorAll('.quiz-option');
            const correct = selectedIndex === currentQuizAnswer;
            
            options.forEach((option, index) => {
                option.onclick = null;
                if (index === currentQuizAnswer) {
                    option.classList.add('correct');
                } else if (index === selectedIndex) {
                    option.classList.add('incorrect');
                }
            });

            // çµ±è¨ˆæ›´æ–°
            const questionIndex = quizQuestions[currentQuizIndex];
            updateQuizStats(questionIndex, correct);

            document.getElementById('next-quiz').classList.remove('hidden');
        }

        // æ¬¡ã®ãƒ†ã‚¹ãƒˆå•é¡Œ
        function nextQuiz() {
            currentQuizIndex++;
            if (currentQuizIndex >= quizQuestions.length) {
                alert('ãƒ†ã‚¹ãƒˆå®Œäº†ï¼çµ±è¨ˆã‚¿ãƒ–ã§çµæœã‚’ç¢ºèªã§ãã¾ã™ã€‚');
                switchTab('statistics');
            } else {
                displayCurrentQuiz();
            }
        }

        // å˜èªãƒªã‚¹ãƒˆæ›´æ–°
        function updateWordLists() {
            const remembered = getStorageData(STORAGE_KEYS.REMEMBERED);
            const notRemembered = getStorageData(STORAGE_KEYS.NOT_REMEMBERED);

            updateWordList('remembered-list', remembered);
            updateWordList('not-remembered-list', notRemembered);
        }

        function updateWordList(listId, data) {
            const listElement = document.getElementById(listId);
            listElement.innerHTML = '';

            const indices = Object.keys(data).map(Number).sort((a, b) => a - b);
            
            if (indices.length === 0) {
                const emptyItem = document.createElement('div');
                emptyItem.className = 'word-item';
                emptyItem.innerHTML = `
                    <div>
                        <div class="word-phrase">ã¾ã å˜èªãŒã‚ã‚Šã¾ã›ã‚“</div>
                        <div class="word-meaning">æš—è¨˜ãƒ¢ãƒ¼ãƒ‰ã§å­¦ç¿’ã‚’é–‹å§‹ã—ã¦ãã ã•ã„</div>
                    </div>
                `;
                listElement.appendChild(emptyItem);
                return;
            }

            indices.forEach(index => {
                const item = document.createElement('div');
                item.className = 'word-item';
                
                const idiom = idiomsData[index];
                const count = data[index];
                
                item.innerHTML = `
                    <div>
                        <div class="word-phrase">${idiom.phrase}</div>
                        <div class="word-meaning">${idiom.meaning}</div>
                    </div>
                    <div>
                        <span style="color: #6c757d; font-size: 0.8rem;">å›æ•°: ${count}</span>
                        ${listId === 'not-remembered-list' ? 
                            `<button class="btn btn-success" style="margin-left: 10px; padding: 5px 10px; font-size: 0.8rem;" onclick="moveToRemembered(${index})">è¦šãˆãŸ</button>` : 
                            `<button class="btn btn-warning" style="margin-left: 10px; padding: 5px 10px; font-size: 0.8rem;" onclick="moveToNotRemembered(${index})">å¿˜ã‚ŒãŸ</button>`
                        }
                    </div>
                `;
                listElement.appendChild(item);
            });
        }

        // å˜èªã®çŠ¶æ…‹å¤‰æ›´
        function moveToRemembered(index) {
            updateWordStatus(index, 'remembered');
            updateWordLists();
        }

        function moveToNotRemembered(index) {
            updateWordStatus(index, 'not-remembered');
            updateWordLists();
        }

        // çµ±è¨ˆæ›´æ–°
        function updateStatistics() {
            const remembered = getStorageData(STORAGE_KEYS.REMEMBERED);
            const notRemembered = getStorageData(STORAGE_KEYS.NOT_REMEMBERED);
            const quizStats = getStorageData(STORAGE_KEYS.QUIZ_STATS);

            // åŸºæœ¬çµ±è¨ˆ
            document.getElementById('total-remembered').textContent = Object.keys(remembered).length;
            document.getElementById('total-not-remembered').textContent = Object.keys(notRemembered).length;

            // ãƒ†ã‚¹ãƒˆçµ±è¨ˆ
            let totalCorrect = 0;
            let totalIncorrect = 0;
            
            Object.values(quizStats).forEach(stat => {
                totalCorrect += stat.correct;
                totalIncorrect += stat.incorrect;
            });

            document.getElementById('quiz-correct').textContent = totalCorrect;
            
            const accuracy = totalCorrect + totalIncorrect > 0 ? 
                Math.round((totalCorrect / (totalCorrect + totalIncorrect)) * 100) : 0;
            document.getElementById('quiz-accuracy').textContent = `${accuracy}%`;
        }

        // çµ±è¨ˆã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
        function exportStatistics() {
            const remembered = getStorageData(STORAGE_KEYS.REMEMBERED);
            const notRemembered = getStorageData(STORAGE_KEYS.NOT_REMEMBERED);
            const quizStats = getStorageData(STORAGE_KEYS.QUIZ_STATS);

            let csvContent = "No.,ç†Ÿèª,æ„å‘³,è¦šãˆãŸå›æ•°,ãƒ†ã‚¹ãƒˆæ­£è§£,ãƒ†ã‚¹ãƒˆä¸æ­£è§£,æ­£è§£ç‡,çŠ¶æ…‹\n";

            idiomsData.forEach((idiom, index) => {
                const rememberedCount = remembered[index] || 0;
                const notRememberedCount = notRemembered[index] || 0;
                const quiz = quizStats[index] || { correct: 0, incorrect: 0 };
                
                const accuracy = quiz.correct + quiz.incorrect > 0 ? 
                    Math.round((quiz.correct / (quiz.correct + quiz.incorrect)) * 100) : 0;
                
                let status = 'æœªåˆ†é¡';
                if (rememberedCount > 0) status = 'è¦šãˆãŸ';
                else if (notRememberedCount > 0) status = 'è¦šãˆã¦ãªã„';

                csvContent += `${index + 1},"${idiom.phrase}","${idiom.meaning}",${rememberedCount},${quiz.correct},${quiz.incorrect},${accuracy}%,${status}\n`;
            });

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'idiom_stats.csv';
            link.click();
        }

        // ãƒ‡ãƒ¼ã‚¿ãƒªã‚»ãƒƒãƒˆ
        function resetStatistics() {
            if (confirm('å…¨ã¦ã®å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')) {
                localStorage.removeItem(STORAGE_KEYS.REMEMBERED);
                localStorage.removeItem(STORAGE_KEYS.NOT_REMEMBERED);
                localStorage.removeItem(STORAGE_KEYS.QUIZ_STATS);
                
                updateStatistics();
                updateWordLists();
                alert('ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸã€‚');
            }
        }

        // å˜èªãƒªã‚¹ãƒˆã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
        function switchWordList(listType) {
            document.querySelectorAll('[data-list]').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-list="${listType}"]`).classList.add('active');

            document.getElementById('remembered-list').classList.add('hidden');
            document.getElementById('not-remembered-list').classList.add('hidden');
            document.getElementById(`${listType}-list`).classList.remove('hidden');
        }

        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
        document.addEventListener('DOMContentLoaded', function() {
            // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    switchTab(tab.dataset.tab);
                });
            });

            // ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆï¼ˆå­¦ç¿’ã‚¿ãƒ–ï¼‰
            document.querySelectorAll('[data-mode]').forEach(btn => {
                btn.addEventListener('click', () => {
                    switchMode(btn.dataset.mode);
                });
            });

            // æš—è¨˜ãƒ¢ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³
            document.getElementById('show-meaning').addEventListener('click', showMeaning);
            document.getElementById('remember-btn').addEventListener('click', () => handleMemorizeResult(true));
            document.getElementById('not-remember-btn').addEventListener('click', () => handleMemorizeResult(false));

            // ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³
            document.getElementById('set-range').addEventListener('click', setQuizRange);
            document.getElementById('next-quiz').addEventListener('click', nextQuiz);

            // å˜èªãƒªã‚¹ãƒˆåˆ‡ã‚Šæ›¿ãˆ
            document.querySelectorAll('[data-list]').forEach(btn => {
                btn.addEventListener('click', () => {
                    switchWordList(btn.dataset.list);
                });
            });

            // çµ±è¨ˆãƒœã‚¿ãƒ³
            document.getElementById('export-stats').addEventListener('click', exportStatistics);
            document.getElementById('reset-stats').addEventListener('click', resetStatistics);

            // åˆæœŸåŒ–
            initMemorizeMode();
            updateStatistics();
        });

        function saveToGoogleSheet(entries) {
          fetch('https://script.google.com/a/macros/soshigakuen.ed.jp/s/AKfycbyZi2h-Y4ZNlDxhN1LYe6zy8fVPWtJ6dxkJG3JgcfZrDs0tCyvWPodJySbreioyHgNXhw/exec', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ entries })
          })
          .then(res => res.text())
          .then(msg => alert("ä¿å­˜å®Œäº†: " + msg))
          .catch(err => {
            console.error(err);
            alert("ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ");
          });
        }

        // exportStatistics ã®ä»£ã‚ã‚Šã«ã“ã®ã‚¤ãƒ™ãƒ³ãƒˆè¿½åŠ 
        document.getElementById('export-stats').addEventListener('click', () => {
          const remembered = getStorageData(STORAGE_KEYS.REMEMBERED);
          const notRemembered = getStorageData(STORAGE_KEYS.NOT_REMEMBERED);

          const entries = [];

          for (const index in remembered) {
            const idiom = idiomsData[index];
            entries.push({
              phrase: idiom.phrase,
              meaning: idiom.meaning,
              status: "è¦šãˆãŸ"
            });
          }

          for (const index in notRemembered) {
            const idiom = idiomsData[index];
            entries.push({
              phrase: idiom.phrase,
              meaning: idiom.meaning,
              status: "è¦šãˆã¦ãªã„"
            });
          }

          saveToGoogleSheet(entries);
        });

    </script>
</body>
</html>
