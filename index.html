<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Idiom Master 300 - Ëã±Ë™ûÁÜüË™ûÂ≠¶Áøí„Ç¢„Éó„É™</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .tabs {
            display: flex;
            background: white;
            border-radius: 10px 10px 0 0;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            background: #f8f9fa;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            border-right: 1px solid #dee2e6;
        }

        .tab:last-child {
            border-right: none;
        }

        .tab.active {
            background: white;
            color: #667eea;
            font-weight: bold;
        }

        .tab:hover:not(.active) {
            background: #e9ecef;
        }

        .content {
            background: white;
            border-radius: 0 0 10px 10px;
            padding: 30px;
            min-height: 500px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .mode-selector {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            justify-content: center;
        }

        .mode-btn {
            padding: 12px 24px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .mode-btn.active {
            background: #667eea;
            color: white;
        }

        .mode-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .study-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            margin-bottom: 30px;
            min-height: 300px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .study-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }

        .study-card.clickable {
            cursor: pointer;
        }

        .study-card.not-clickable {
            cursor: default;
        }

        .phrase {
            font-size: 2rem;
            color: #667eea;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .meaning {
            font-size: 1.3rem;
            color: #495057;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .quiz-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 30px;
        }

        .quiz-option {
            padding: 15px;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .quiz-option:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .quiz-option.correct {
            background: #d4edda;
            border-color: #28a745;
        }

        .quiz-option.incorrect {
            background: #f8d7da;
            border-color: #dc3545;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            min-width: 120px;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .range-selector {
            display: flex;
            gap: 10px;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .range-input {
            padding: 8px 12px;
            border: 2px solid #dee2e6;
            border-radius: 5px;
            width: 80px;
            text-align: center;
        }

        .word-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #dee2e6;
            border-radius: 10px;
        }

        .word-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #dee2e6;
            transition: background 0.3s ease;
        }

        .word-item:hover {
            background: #f8f9fa;
        }

        .word-item:last-child {
            border-bottom: none;
        }

        .word-phrase {
            font-weight: bold;
            color: #667eea;
        }

        .word-meaning {
            color: #6c757d;
            font-size: 0.9rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            color: #6c757d;
            margin-top: 5px;
        }

        .progress-info {
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.1rem;
        }

        .progress-counter {
            color: #667eea;
            font-weight: bold;
        }

        .hidden {
            display: none !important;
        }

        @media (max-width: 600px) {
            .container {
                padding: 10px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .phrase {
                font-size: 1.5rem;
            }

            .meaning {
                font-size: 1.1rem;
            }

            .quiz-options {
                grid-template-columns: 1fr;
            }

            .action-buttons {
                flex-direction: column;
            }

            .tabs {
                flex-direction: column;
            }

            .tab {
                border-right: none;
                border-bottom: 1px solid #dee2e6;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìö Idiom Master 300</h1>
            <p>Ëã±Ë™û„ÅÆÈáçË¶ÅÁÜüË™û300ÂÄã„ÇíÂäπÁéáÁöÑ„Å´Â≠¶Áøí</p>
        </div>

        <div class="tabs">
            <button class="tab active" data-tab="study">Â≠¶Áøí</button>
            <button class="tab" data-tab="wordlist">ÂçòË™û„É™„Çπ„Éà</button>
            <button class="tab" data-tab="statistics">Áµ±Ë®à</button>
        </div>

        <div class="content">
            <!-- Â≠¶Áøí„Çø„Éñ -->
            <div id="study-tab" class="tab-content">
                <div class="mode-selector">
                    <button class="mode-btn active" data-mode="memorize">ÊöóË®ò„É¢„Éº„Éâ</button>
                    <button class="mode-btn" data-mode="quiz">„ÉÜ„Çπ„Éà„É¢„Éº„Éâ</button>
                </div>

                <!-- ÊöóË®ò„É¢„Éº„Éâ -->
                <div id="memorize-mode" class="mode-content">
                    <div class="progress-info">
                        <span class="progress-counter">1 / 300</span>
                    </div>
                    <div class="study-card clickable">
                        <div class="phrase">ÁÜüË™û„ÇíË™≠„ÅøËæº„Åø‰∏≠...</div>
                        <div class="meaning hidden">ÊÑèÂë≥„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô</div>
                        <div style="margin-top: 20px; color: #6c757d; font-size: 0.9rem;">
                            üí° „Ç´„Éº„Éâ„Çí„ÇØ„É™„ÉÉ„ÇØ„Åæ„Åü„ÅØ„ÄåÊÑèÂë≥„ÇíË°®Á§∫„Äç„Éú„Çø„É≥„ÅßÊÑèÂë≥„ÇíÁ¢∫Ë™ç
                        </div>
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-primary" id="show-meaning">ÊÑèÂë≥„ÇíË°®Á§∫</button>
                        <button class="btn btn-success hidden" id="remember-btn">Ë¶ö„Åà„ÅüÔºÅ</button>
                        <button class="btn btn-warning hidden" id="not-remember-btn">Ë¶ö„Åà„Å¶„Å™„ÅÑ</button>
                    </div>
                </div>

                <!-- „ÉÜ„Çπ„Éà„É¢„Éº„Éâ -->
                <div id="quiz-mode" class="mode-content hidden">
                    <div class="range-selector">
                        <span>ÁØÑÂõ≤Ë®≠ÂÆöÔºöNo.</span>
                        <input type="number" class="range-input" id="range-start" min="1" max="300" value="1">
                        <span>ÔΩû</span>
                        <input type="number" class="range-input" id="range-end" min="1" max="300" value="50">
                        <button class="btn btn-primary" id="set-range">ÁØÑÂõ≤Ë®≠ÂÆö</button>
                    </div>
                    <div class="progress-info">
                        <span class="progress-counter">ÂïèÈ°å„ÇíË®≠ÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ</span>
                    </div>
                    <div class="study-card">
                        <div class="phrase">„ÉÜ„Çπ„ÉàÁØÑÂõ≤„ÇíË®≠ÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>
                        <div class="quiz-options hidden">
                            <div class="quiz-option" data-option="0">ÈÅ∏ÊäûËÇ¢1</div>
                            <div class="quiz-option" data-option="1">ÈÅ∏ÊäûËÇ¢2</div>
                            <div class="quiz-option" data-option="2">ÈÅ∏ÊäûËÇ¢3</div>
                            <div class="quiz-option" data-option="3">ÈÅ∏ÊäûËÇ¢4</div>
                        </div>
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-primary hidden" id="next-quiz">Ê¨°„ÅÆÂïèÈ°å</button>
                    </div>
                </div>
            </div>

            <!-- ÂçòË™û„É™„Çπ„Éà„Çø„Éñ -->
            <div id="wordlist-tab" class="tab-content hidden">
                <div class="mode-selector">
                    <button class="mode-btn active" data-list="remembered">Ë¶ö„Åà„ÅüÂçòË™û</button>
                    <button class="mode-btn" data-list="not-remembered">Ë¶ö„Åà„Å¶„Å™„ÅÑÂçòË™û</button>
                </div>

                <div id="remembered-list" class="word-list">
                    <div class="word-item">
                        <div>
                            <div class="word-phrase">„Åæ„Å†Ë¶ö„Åà„ÅüÂçòË™û„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</div>
                            <div class="word-meaning">ÊöóË®ò„É¢„Éº„Éâ„ÅßÂ≠¶Áøí„ÇíÈñãÂßã„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>
                        </div>
                    </div>
                </div>

                <div id="not-remembered-list" class="word-list hidden">
                    <div class="word-item">
                        <div>
                            <div class="word-phrase">„Åæ„Å†Ë¶ö„Åà„Å¶„ÅÑ„Å™„ÅÑÂçòË™û„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</div>
                            <div class="word-meaning">ÊöóË®ò„É¢„Éº„Éâ„ÅßÂ≠¶Áøí„ÇíÈñãÂßã„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Áµ±Ë®à„Çø„Éñ -->
            <div id="statistics-tab" class="tab-content hidden">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="total-remembered">0</div>
                        <div class="stat-label">Ë¶ö„Åà„ÅüÂçòË™ûÊï∞</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="total-not-remembered">0</div>
                        <div class="stat-label">Ë¶ö„Åà„Å¶„Å™„ÅÑÂçòË™ûÊï∞</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="quiz-correct">0</div>
                        <div class="stat-label">„ÉÜ„Çπ„ÉàÊ≠£Ëß£Êï∞</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="quiz-accuracy">0%</div>
                        <div class="stat-label">„ÉÜ„Çπ„ÉàÊ≠£Ëß£Áéá</div>
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="btn btn-primary" id="export-stats">Áµ±Ë®à„Çí„Ç®„ÇØ„Çπ„Éù„Éº„Éà</button>
                    <button class="btn btn-danger" id="reset-stats">„Éá„Éº„Çø„Çí„É™„Çª„ÉÉ„Éà</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ÁÜüË™û„Éá„Éº„ÇøÔºà300Ë™û„ÅÆ„Çµ„É≥„Éó„É´Ôºâ
        const idiomsData = [
            { phrase: "lead to ÔΩû", meaning: "ÔΩûÔºà„Å®„ÅÑ„ÅÜÁµêÊûúÔºâ„ÇíÂºï„ÅçËµ∑„Åì„Åô„ÄÅÔΩû„Å∏„Å®ÈÄö„Åò„Çã" },
            { phrase: "look forward to ÔΩû", meaning: "ÔΩû„ÇíÊ•Ω„Åó„Åø„Å´„Åó„Å¶„ÅÑ„Çã" },
            { phrase: "take care of ÔΩû", meaning: "ÔΩû„ÅÆ‰∏ñË©±„Çí„Åô„Çã„ÄÅÔΩû„ÇíÂá¶ÁêÜ„Åô„Çã" },
            { phrase: "come up with ÔΩû", meaning: "ÔΩû„ÇíÊÄù„ÅÑ„Å§„Åè„ÄÅÔΩû„ÇíËÄÉ„ÅàÂá∫„Åô" },
            { phrase: "get rid of ÔΩû", meaning: "ÔΩû„ÇíÂèñ„ÇäÈô§„Åè„ÄÅÔΩû„ÇíÂá¶ÂàÜ„Åô„Çã" },
            { phrase: "put off ÔΩû", meaning: "ÔΩû„ÇíÂª∂Êúü„Åô„Çã" },
            { phrase: "turn out", meaning: "ÁµêÊûú„Å®„Åó„Å¶ÔΩû„Å´„Å™„Çã" },
            { phrase: "break down", meaning: "ÊïÖÈöú„Åô„Çã„ÄÅÂàÜËß£„Åô„Çã" },
            { phrase: "bring up ÔΩû", meaning: "ÔΩû„ÇíËÇ≤„Å¶„Çã„ÄÅÔΩû„ÇíË©±È°å„Å´„Åô„Çã" },
            { phrase: "carry out ÔΩû", meaning: "ÔΩû„ÇíÂÆüË°å„Åô„Çã„ÄÅÔΩû„ÇíÈÅÇË°å„Åô„Çã" },
            { phrase: "check out ÔΩû", meaning: "ÔΩû„ÇíË™ø„Åπ„Çã„ÄÅÔΩû„Çí„ÉÅ„Çß„ÉÉ„ÇØ„Ç¢„Ç¶„Éà„Åô„Çã" },
            { phrase: "deal with ÔΩû", meaning: "ÔΩû„Å´ÂØæÂá¶„Åô„Çã„ÄÅÔΩû„ÇíÊâ±„ÅÜ" },
            { phrase: "end up ÔΩû", meaning: "ÁµêÂ±ÄÔΩû„Å´„Å™„Çã" },
            { phrase: "figure out ÔΩû", meaning: "ÔΩû„ÇíÁêÜËß£„Åô„Çã„ÄÅÔΩû„ÇíËß£Ê±∫„Åô„Çã" },
            { phrase: "give up ÔΩû", meaning: "ÔΩû„Çí„ÅÇ„Åç„Çâ„ÇÅ„Çã" },
            { phrase: "hang out", meaning: "„Å∂„Çâ„Å∂„Çâ„Åô„Çã„ÄÅ„Åü„ÇÄ„Çç„Åô„Çã" },
            { phrase: "keep on ÔΩû", meaning: "ÔΩû„ÇíÁ∂ö„Åë„Çã" },
            { phrase: "make up ÔΩû", meaning: "ÔΩû„Çí‰Ωú„Çä‰∏ä„Åí„Çã„ÄÅÔΩû„ÇíÊßãÊàê„Åô„Çã" },
            { phrase: "pick up ÔΩû", meaning: "ÔΩû„ÇíÊãæ„ÅÜ„ÄÅÔΩû„ÇíËøé„Åà„Å´Ë°å„Åè" },
            { phrase: "point out ÔΩû", meaning: "ÔΩû„ÇíÊåáÊëò„Åô„Çã" },
            { phrase: "run into ÔΩû", meaning: "ÔΩû„Å´ÂÅ∂ÁÑ∂Âá∫‰ºö„ÅÜ" },
            { phrase: "set up ÔΩû", meaning: "ÔΩû„ÇíË®≠Á´ã„Åô„Çã„ÄÅÔΩû„ÇíË®≠ÁΩÆ„Åô„Çã" },
            { phrase: "show up", meaning: "Áèæ„Çå„Çã„ÄÅÂßø„ÇíË¶ã„Åõ„Çã" },
            { phrase: "take off", meaning: "Èõ¢Èô∏„Åô„Çã„ÄÅËÑ±„Åê" },
            { phrase: "work out", meaning: "„ÅÜ„Åæ„Åè„ÅÑ„Åè„ÄÅÈÅãÂãï„Åô„Çã" },
            { phrase: "account for ÔΩû", meaning: "ÔΩû„ÇíË™¨Êòé„Åô„Çã„ÄÅÔΩû„ÅÆÂéüÂõ†„Å®„Å™„Çã" },
            { phrase: "back up ÔΩû", meaning: "ÔΩû„ÇíÊîØÊè¥„Åô„Çã„ÄÅÔΩû„Çí„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„Åô„Çã" },
            { phrase: "call off ÔΩû", meaning: "ÔΩû„Çí‰∏≠Ê≠¢„Åô„Çã" },
            { phrase: "drop by", meaning: "Á´ã„Å°ÂØÑ„Çã" },
            { phrase: "fill in ÔΩû", meaning: "ÔΩû„Å´Ë®òÂÖ•„Åô„Çã„ÄÅÔΩû„ÅÆ‰ª£ÂΩπ„Çí„Åô„Çã" },
            { phrase: "go over ÔΩû", meaning: "ÔΩû„ÇíË™ø„Åπ„Çã„ÄÅÔΩû„ÇíÂæ©Áøí„Åô„Çã" },
            { phrase: "hold on", meaning: "ÂæÖ„Å§„ÄÅ„Åó„Å£„Åã„Çä„Å§„Åã„Åæ„Çã" },
            { phrase: "look after ÔΩû", meaning: "ÔΩû„ÅÆ‰∏ñË©±„Çí„Åô„Çã" },
            { phrase: "make out ÔΩû", meaning: "ÔΩû„ÇíÁêÜËß£„Åô„Çã„ÄÅÔΩû„ÇíË¶ãÂàÜ„Åë„Çã" },
            { phrase: "pass away", meaning: "‰∫°„Åè„Å™„Çã" },
            { phrase: "put up with ÔΩû", meaning: "ÔΩû„ÇíÊàëÊÖ¢„Åô„Çã" },
            { phrase: "run out of ÔΩû", meaning: "ÔΩû„ÇíÂàá„Çâ„Åô" },
            { phrase: "stand for ÔΩû", meaning: "ÔΩû„ÇíË°®„Åô„ÄÅÔΩû„ÇíÊîØÊåÅ„Åô„Çã" },
            { phrase: "take after ÔΩû", meaning: "ÔΩû„Å´‰ºº„Å¶„ÅÑ„Çã" },
            { phrase: "wear out", meaning: "„Åô„ÇäÂàá„Çå„Çã„ÄÅÁñ≤„ÇåÊûú„Å¶„Çã" },
            { phrase: "be supposed to ÔΩû", meaning: "ÔΩû„Åô„Çã„Åì„Å®„Å´„Å™„Å£„Å¶„ÅÑ„Çã" },
            { phrase: "be used to ÔΩû", meaning: "ÔΩû„Å´ÊÖ£„Çå„Å¶„ÅÑ„Çã" },
            { phrase: "get used to ÔΩû", meaning: "ÔΩû„Å´ÊÖ£„Çå„Çã" },
            { phrase: "have to ÔΩû", meaning: "ÔΩû„Åó„Å™„Åë„Çå„Å∞„Å™„Çâ„Å™„ÅÑ" },
            { phrase: "ought to ÔΩû", meaning: "ÔΩû„Åô„Åπ„Åç„Åß„ÅÇ„Çã" },
            { phrase: "would rather ÔΩû", meaning: "„ÇÄ„Åó„ÇçÔΩû„Åó„Åü„ÅÑ" },
            { phrase: "as long as ÔΩû", meaning: "ÔΩû„Åô„ÇãÈôê„Çä„ÄÅÔΩû„Åß„ÅÇ„ÇãÈôê„Çä" },
            { phrase: "as soon as ÔΩû", meaning: "ÔΩû„Åô„Çã„Å®„Åô„Åê„Å´" },
            { phrase: "even though ÔΩû", meaning: "ÔΩû„Å´„ÇÇ„Åã„Åã„Çè„Çâ„Åö" },
            { phrase: "in case ÔΩû", meaning: "ÔΩû„ÅÆÂ†¥Âêà„Å´ÂÇô„Åà„Å¶" },
            // „Åì„Åì„Å´ÊÆã„Çä250Ë™û„ÇíËøΩÂä†ÔºàÂÆüÈöõ„ÅÆ„Ç¢„Éó„É™„Åß„ÅØÂÖ®300Ë™û„ÇíÂê´„ÇÅ„ÇãÔºâ
        ];

        // ÊÆã„Çä„ÅÆ250Ë™û„ÇíÁîüÊàêÔºà„Éá„É¢Áî®Ôºâ
        for (let i = 51; i <= 300; i++) {
            idiomsData.push({
                phrase: `idiom phrase ${i}`,
                meaning: `ÁÜüË™û${i}„ÅÆÊÑèÂë≥Ë™¨Êòé`
            });
        }

        // „Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥Áä∂ÊÖã
        let currentMode = 'memorize';
        let currentTab = 'study';
        let currentIndex = 0;
        let quizRange = { start: 1, end: 50 };
        let quizQuestions = [];
        let currentQuizIndex = 0;
        let currentQuizAnswer = -1;

        // „É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„Ç≠„Éº
        const STORAGE_KEYS = {
            REMEMBERED: 'idiom_remembered',
            NOT_REMEMBERED: 'idiom_not_remembered',
            QUIZ_STATS: 'idiom_quiz_stats'
        };

        // „Éá„Éº„ÇøÁÆ°ÁêÜ
        function getStorageData(key) {
            const data = localStorage.getItem(key);
            return data ? JSON.parse(data) : {};
        }

        function setStorageData(key, data) {
            localStorage.setItem(key, JSON.stringify(data));
        }

        function updateWordStatus(index, status) {
            const remembered = getStorageData(STORAGE_KEYS.REMEMBERED);
            const notRemembered = getStorageData(STORAGE_KEYS.NOT_REMEMBERED);

            if (status === 'remembered') {
                remembered[index] = (remembered[index] || 0) + 1;
                delete notRemembered[index];
            } else {
                notRemembered[index] = (notRemembered[index] || 0) + 1;
                delete remembered[index];
            }

            setStorageData(STORAGE_KEYS.REMEMBERED, remembered);
            setStorageData(STORAGE_KEYS.NOT_REMEMBERED, notRemembered);
        }

        function updateQuizStats(index, correct) {
            const stats = getStorageData(STORAGE_KEYS.QUIZ_STATS);
            if (!stats[index]) {
                stats[index] = { correct: 0, incorrect: 0 };
            }

            if (correct) {
                stats[index].correct++;
            } else {
                stats[index].incorrect++;
            }

            setStorageData(STORAGE_KEYS.QUIZ_STATS, stats);
        }

        // „Çø„ÉñÂàá„ÇäÊõø„Åà
        function switchTab(tabName) {
            // „Çø„Éñ„Éú„Çø„É≥„ÅÆÁä∂ÊÖãÊõ¥Êñ∞
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');

            // „Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÅÆË°®Á§∫Âàá„ÇäÊõø„Åà
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            document.getElementById(`${tabName}-tab`).classList.remove('hidden');

            currentTab = tabName;

            if (tabName === 'wordlist') {
                updateWordLists();
            } else if (tabName === 'statistics') {
                updateStatistics();
            }
        }

        // „É¢„Éº„ÉâÂàá„ÇäÊõø„Åà
        function switchMode(mode) {
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-mode="${mode}"]`).classList.add('active');

            document.querySelectorAll('.mode-content').forEach(content => {
                content.classList.add('hidden');
            });
            document.getElementById(`${mode}-mode`).classList.remove('hidden');

            currentMode = mode;

            if (mode === 'memorize') {
                initMemorizeMode();
            }
        }

        // ÊöóË®ò„É¢„Éº„ÉâÂàùÊúüÂåñ
        function initMemorizeMode() {
            currentIndex = 0;
            displayCurrentPhrase();
        }

        // ÁèæÂú®„ÅÆÁÜüË™û„ÇíË°®Á§∫
        function displayCurrentPhrase() {
            const phrase = document.querySelector('#memorize-mode .phrase');
            const meaning = document.querySelector('#memorize-mode .meaning');
            const progress = document.querySelector('#memorize-mode .progress-counter');
            const studyCard = document.querySelector('#memorize-mode .study-card');

            phrase.textContent = idiomsData[currentIndex].phrase;
            meaning.textContent = idiomsData[currentIndex].meaning;
            meaning.classList.add('hidden');

            progress.textContent = `${currentIndex + 1} / ${idiomsData.length}`;

            // „Ç´„Éº„Éâ„Å´„ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„ÉàËøΩÂä†
            studyCard.classList.add('clickable');
            studyCard.classList.remove('not-clickable');
            studyCard.onclick = showMeaning;

            // „Éú„Çø„É≥„ÅÆÁä∂ÊÖã„É™„Çª„ÉÉ„Éà
            document.getElementById('show-meaning').classList.remove('hidden');
            document.getElementById('remember-btn').classList.add('hidden');
            document.getElementById('not-remember-btn').classList.add('hidden');
        }

        // ÊÑèÂë≥„ÇíË°®Á§∫
        function showMeaning() {
            const meaning = document.querySelector('#memorize-mode .meaning');
            const studyCard = document.querySelector('#memorize-mode .study-card');
            
            // Êó¢„Å´ÊÑèÂë≥„ÅåË°®Á§∫„Åï„Çå„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅØ‰Ωï„ÇÇ„Åó„Å™„ÅÑ
            if (!meaning.classList.contains('hidden')) {
                return;
            }

            meaning.classList.remove('hidden');

            // „Ç´„Éº„Éâ„ÅÆ„ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„Éà„ÇíÁÑ°ÂäπÂåñ
            studyCard.classList.remove('clickable');
            studyCard.classList.add('not-clickable');
            studyCard.onclick = null;

            document.getElementById('show-meaning').classList.add('hidden');
            document.getElementById('remember-btn').classList.remove('hidden');
            document.getElementById('not-remember-btn').classList.remove('hidden');
        }

        // Ë¶ö„Åà„Åü/Ë¶ö„Åà„Å¶„ÅÑ„Å™„ÅÑ„Éú„Çø„É≥„ÅÆÂá¶ÁêÜ
        function handleMemorizeResult(remembered) {
            updateWordStatus(currentIndex, remembered ? 'remembered' : 'not-remembered');
            
            currentIndex++;
            if (currentIndex >= idiomsData.length) {
                currentIndex = 0;
            }
            
            setTimeout(() => {
                displayCurrentPhrase();
            }, 500);
        }

        // „ÉÜ„Çπ„Éà„É¢„Éº„ÉâÁØÑÂõ≤Ë®≠ÂÆö
        function setQuizRange() {
            const start = parseInt(document.getElementById('range-start').value);
            const end = parseInt(document.getElementById('range-end').value);

            if (start < 1 || end > idiomsData.length || start > end) {
                alert('Ê≠£„Åó„ÅÑÁØÑÂõ≤„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºà1-300Ôºâ');
                return;
            }

            quizRange = { start: start - 1, end: end - 1 };
            generateQuizQuestions();
            displayCurrentQuiz();
        }

        // „ÉÜ„Çπ„ÉàÂïèÈ°åÁîüÊàê
        function generateQuizQuestions() {
            quizQuestions = [];
            for (let i = quizRange.start; i <= quizRange.end; i++) {
                quizQuestions.push(i);
            }
            
            // „Ç∑„É£„ÉÉ„Éï„É´
            for (let i = quizQuestions.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [quizQuestions[i], quizQuestions[j]] = [quizQuestions[j], quizQuestions[i]];
            }
            
            currentQuizIndex = 0;
        }

        // ÁèæÂú®„ÅÆ„ÉÜ„Çπ„ÉàÂïèÈ°åË°®Á§∫
        function displayCurrentQuiz() {
            if (currentQuizIndex >= quizQuestions.length) {
                alert('„ÉÜ„Çπ„ÉàÂÆå‰∫ÜÔºÅ');
                return;
            }

            const questionIndex = quizQuestions[currentQuizIndex];
            const correctAnswer = idiomsData[questionIndex];
            
            // ÈÅ∏ÊäûËÇ¢ÁîüÊàê
            const options = [correctAnswer];
            const usedIndices = new Set([questionIndex]);
            
            while (options.length < 4) {
                const randomIndex = Math.floor(Math.random() * idiomsData.length);
                if (!usedIndices.has(randomIndex)) {
                    options.push(idiomsData[randomIndex]);
                    usedIndices.add(randomIndex);
                }
            }
            
            // „Ç∑„É£„ÉÉ„Éï„É´
            for (let i = options.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [options[i], options[j]] = [options[j], options[i]];
            }
            
            currentQuizAnswer = options.indexOf(correctAnswer);

            // UIÊõ¥Êñ∞
            const phrase = document.querySelector('#quiz-mode .phrase');
            const quizOptions = document.querySelector('.quiz-options');
            const progress = document.querySelector('#quiz-mode .progress-counter');

            phrase.textContent = correctAnswer.phrase;
            progress.textContent = `${currentQuizIndex + 1} / ${quizQuestions.length}`;

            quizOptions.classList.remove('hidden');
            document.querySelectorAll('.quiz-option').forEach((option, index) => {
                option.textContent = options[index].meaning;
                option.className = 'quiz-option';
                option.onclick = () => selectQuizOption(index);
            });

            document.getElementById('next-quiz').classList.add('hidden');
        }

        // „ÉÜ„Çπ„ÉàÈÅ∏ÊäûËÇ¢ÈÅ∏Êäû
        function selectQuizOption(selectedIndex) {
            const options = document.querySelectorAll('.quiz-option');
            const correct = selectedIndex === currentQuizAnswer;
            
            options.forEach((option, index) => {
                option.onclick = null;
                if (index === currentQuizAnswer) {
                    option.classList.add('correct');
                } else if (index === selectedIndex) {
                    option.classList.add('incorrect');
                }
            });

            // Áµ±Ë®àÊõ¥Êñ∞
            const questionIndex = quizQuestions[currentQuizIndex];
            updateQuizStats(questionIndex, correct);

            document.getElementById('next-quiz').classList.remove('hidden');
        }

        // Ê¨°„ÅÆ„ÉÜ„Çπ„ÉàÂïèÈ°å
        function nextQuiz() {
            currentQuizIndex++;
            if (currentQuizIndex >= quizQuestions.length) {
                alert('„ÉÜ„Çπ„ÉàÂÆå‰∫ÜÔºÅÁµ±Ë®à„Çø„Éñ„ÅßÁµêÊûú„ÇíÁ¢∫Ë™ç„Åß„Åç„Åæ„Åô„ÄÇ');
                switchTab('statistics');
            } else {
                displayCurrentQuiz();
            }
        }

        // ÂçòË™û„É™„Çπ„ÉàÊõ¥Êñ∞
        function updateWordLists() {
            const remembered = getStorageData(STORAGE_KEYS.REMEMBERED);
            const notRemembered = getStorageData(STORAGE_KEYS.NOT_REMEMBERED);

            updateWordList('remembered-list', remembered);
            updateWordList('not-remembered-list', notRemembered);
        }

        function updateWordList(listId, data) {
            const listElement = document.getElementById(listId);
            listElement.innerHTML = '';

            const indices = Object.keys(data).map(Number).sort((a, b) => a - b);
            
            if (indices.length === 0) {
                const emptyItem = document.createElement('div');
                emptyItem.className = 'word-item';
                emptyItem.innerHTML = `
                    <div>
                        <div class="word-phrase">„Åæ„Å†ÂçòË™û„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</div>
                        <div class="word-meaning">ÊöóË®ò„É¢„Éº„Éâ„ÅßÂ≠¶Áøí„ÇíÈñãÂßã„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>
                    </div>
                `;
                listElement.appendChild(emptyItem);
                return;
            }

            indices.forEach(index => {
                const item = document.createElement('div');
                item.className = 'word-item';
                
                const idiom = idiomsData[index];
                const count = data[index];
                
                item.innerHTML = `
                    <div>
                        <div class="word-phrase">${idiom.phrase}</div>
                        <div class="word-meaning">${idiom.meaning}</div>
                    </div>
                    <div>
                        <span style="color: #6c757d; font-size: 0.8rem;">ÂõûÊï∞: ${count}</span>
                        ${listId === 'not-remembered-list' ? 
                            `<button class="btn btn-success" style="margin-left: 10px; padding: 5px 10px; font-size: 0.8rem;" onclick="moveToRemembered(${index})">Ë¶ö„Åà„Åü</button>` : 
                            `<button class="btn btn-warning" style="margin-left: 10px; padding: 5px 10px; font-size: 0.8rem;" onclick="moveToNotRemembered(${index})">Âøò„Çå„Åü</button>`
                        }
                    </div>
                `;
                listElement.appendChild(item);
            });
        }

        // ÂçòË™û„ÅÆÁä∂ÊÖãÂ§âÊõ¥
        function moveToRemembered(index) {
            updateWordStatus(index, 'remembered');
            updateWordLists();
        }

        function moveToNotRemembered(index) {
            updateWordStatus(index, 'not-remembered');
            updateWordLists();
        }

        // Áµ±Ë®àÊõ¥Êñ∞
        function updateStatistics() {
            const remembered = getStorageData(STORAGE_KEYS.REMEMBERED);
            const notRemembered = getStorageData(STORAGE_KEYS.NOT_REMEMBERED);
            const quizStats = getStorageData(STORAGE_KEYS.QUIZ_STATS);

            // Âü∫Êú¨Áµ±Ë®à
            document.getElementById('total-remembered').textContent = Object.keys(remembered).length;
            document.getElementById('total-not-remembered').textContent = Object.keys(notRemembered).length;

            // „ÉÜ„Çπ„ÉàÁµ±Ë®à
            let totalCorrect = 0;
            let totalIncorrect = 0;
            
            Object.values(quizStats).forEach(stat => {
                totalCorrect += stat.correct;
                totalIncorrect += stat.incorrect;
            });

            document.getElementById('quiz-correct').textContent = totalCorrect;
            
            const accuracy = totalCorrect + totalIncorrect > 0 ? 
                Math.round((totalCorrect / (totalCorrect + totalIncorrect)) * 100) : 0;
            document.getElementById('quiz-accuracy').textContent = `${accuracy}%`;
        }

        // Áµ±Ë®à„Ç®„ÇØ„Çπ„Éù„Éº„Éà
        function exportStatistics() {
            const remembered = getStorageData(STORAGE_KEYS.REMEMBERED);
            const notRemembered = getStorageData(STORAGE_KEYS.NOT_REMEMBERED);
            const quizStats = getStorageData(STORAGE_KEYS.QUIZ_STATS);

            let csvContent = "No.,ÁÜüË™û,ÊÑèÂë≥,Ë¶ö„Åà„ÅüÂõûÊï∞,„ÉÜ„Çπ„ÉàÊ≠£Ëß£,„ÉÜ„Çπ„Éà‰∏çÊ≠£Ëß£,Ê≠£Ëß£Áéá,Áä∂ÊÖã\n";

            idiomsData.forEach((idiom, index) => {
                const rememberedCount = remembered[index] || 0;
                const notRememberedCount = notRemembered[index] || 0;
                const quiz = quizStats[index] || { correct: 0, incorrect: 0 };
                
                const accuracy = quiz.correct + quiz.incorrect > 0 ? 
                    Math.round((quiz.correct / (quiz.correct + quiz.incorrect)) * 100) : 0;
                
                let status = 'Êú™ÂàÜÈ°û';
                if (rememberedCount > 0) status = 'Ë¶ö„Åà„Åü';
                else if (notRememberedCount > 0) status = 'Ë¶ö„Åà„Å¶„Å™„ÅÑ';

                csvContent += `${index + 1},"${idiom.phrase}","${idiom.meaning}",${rememberedCount},${quiz.correct},${quiz.incorrect},${accuracy}%,${status}\n`;
            });

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'idiom_stats.csv';
            link.click();
        }

        // „Éá„Éº„Çø„É™„Çª„ÉÉ„Éà
        function resetStatistics() {
            if (confirm('ÂÖ®„Å¶„ÅÆÂ≠¶Áøí„Éá„Éº„Çø„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åô„ÅãÔºü„Åì„ÅÆÊìç‰Ωú„ÅØÂèñ„ÇäÊ∂à„Åõ„Åæ„Åõ„Çì„ÄÇ')) {
                localStorage.removeItem(STORAGE_KEYS.REMEMBERED);
                localStorage.removeItem(STORAGE_KEYS.NOT_REMEMBERED);
                localStorage.removeItem(STORAGE_KEYS.QUIZ_STATS);
                
                updateStatistics();
                updateWordLists();
                alert('„Éá„Éº„Çø„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åó„Åü„ÄÇ');
            }
        }

        // ÂçòË™û„É™„Çπ„Éà„Çø„ÉñÂàá„ÇäÊõø„Åà
        function switchWordList(listType) {
            document.querySelectorAll('[data-list]').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-list="${listType}"]`).classList.add('active');

            document.getElementById('remembered-list').classList.add('hidden');
            document.getElementById('not-remembered-list').classList.add('hidden');
            document.getElementById(`${listType}-list`).classList.remove('hidden');
        }

        // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„ÉºË®≠ÂÆö
        document.addEventListener('DOMContentLoaded', function() {
            // „Çø„ÉñÂàá„ÇäÊõø„Åà
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    switchTab(tab.dataset.tab);
                });
            });

            // „É¢„Éº„ÉâÂàá„ÇäÊõø„ÅàÔºàÂ≠¶Áøí„Çø„ÉñÔºâ
            document.querySelectorAll('[data-mode]').forEach(btn => {
                btn.addEventListener('click', () => {
                    switchMode(btn.dataset.mode);
                });
            });

            // ÊöóË®ò„É¢„Éº„Éâ„Éú„Çø„É≥
            document.getElementById('show-meaning').addEventListener('click', showMeaning);
            document.getElementById('remember-btn').addEventListener('click', () => handleMemorizeResult(true));
            document.getElementById('not-remember-btn').addEventListener('click', () => handleMemorizeResult(false));

            // „ÉÜ„Çπ„Éà„É¢„Éº„Éâ„Éú„Çø„É≥
            document.getElementById('set-range').addEventListener('click', setQuizRange);
            document.getElementById('next-quiz').addEventListener('click', nextQuiz);

            // ÂçòË™û„É™„Çπ„ÉàÂàá„ÇäÊõø„Åà
            document.querySelectorAll('[data-list]').forEach(btn => {
                btn.addEventListener('click', () => {
                    switchWordList(btn.dataset.list);
                });
            });

            // Áµ±Ë®à„Éú„Çø„É≥
            document.getElementById('export-stats').addEventListener('click', exportStatistics);
            document.getElementById('reset-stats').addEventListener('click', resetStatistics);

            // ÂàùÊúüÂåñ
            initMemorizeMode();
            updateStatistics();
        });

        function saveToGoogleSheet(entries) {
          fetch('https://script.google.com/a/macros/soshigakuen.ed.jp/s/AKfycbyZi2h-Y4ZNlDxhN1LYe6zy8fVPWtJ6dxkJG3JgcfZrDs0tCyvWPodJySbreioyHgNXhw/exec', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ entries })
          })
          .then(res => res.text())
          .then(msg => alert("‰øùÂ≠òÂÆå‰∫Ü: " + msg))
          .catch(err => {
            console.error(err);
            alert("‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü");
          });
        }

        // exportStatistics „ÅÆ‰ª£„Çè„Çä„Å´„Åì„ÅÆ„Ç§„Éô„É≥„ÉàËøΩÂä†
        document.getElementById('export-stats').addEventListener('click', () => {
          const remembered = getStorageData(STORAGE_KEYS.REMEMBERED);
          const notRemembered = getStorageData(STORAGE_KEYS.NOT_REMEMBERED);

          const entries = [];

          for (const index in remembered) {
            const idiom = idiomsData[index];
            entries.push({
              phrase: idiom.phrase,
              meaning: idiom.meaning,
              status: "Ë¶ö„Åà„Åü"
            });
          }

          for (const index in notRemembered) {
            const idiom = idiomsData[index];
            entries.push({
              phrase: idiom.phrase,
              meaning: idiom.meaning,
              status: "Ë¶ö„Åà„Å¶„Å™„ÅÑ"
            });
          }

          saveToGoogleSheet(entries);
        });

    </script>
</body>
</html>
